<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>교보 DTS 지원</title>
    <link rel="stylesheet" href="apply.css">
</head>
<body>
    <div class="container">
        <h1>교보 DTS 참가 신청서</h1>
        <form id="survey-form">
            <div class="form-group">
                <label for="name">이름:</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="ssn">주민번호 앞자리:</label>
                <input type="text" id="date_of_birth" name="date_of_birth" required>
            </div>

            <div class="form-group">
                <label for="phone_num">휴대전화:</label>
                <input type="tel" id="phone_num" name="phone_num" required>
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="residence">거주지:</label>
                <input type="text" id="residence" name="residence" required>
            </div>

            <div class="form-group">
                <label>학력사항:</label>
                <select name="educational_background" id="educational_background" required>
                    <option value="high-school">고등학교 졸업</option>
                    <option value="associate-degree">전문학사</option>
                    <option value="university-in-progress-credits">대학 재학(졸업학점 이수 O)</option>
                    <option value="university-in-progress-no-credits">대학 재학(졸업학점 이수 X)</option>
                    <option value="bachelor">학사</option>
                    <option value="master">석사 이상</option>
                </select>
            </div>

            <div class="form-group">
                <label for="school">학교:</label>
                <input type="text" id="school" name="school">
            </div>

            <div class="form-group">
                <label for="major">전공학과:</label>
                <input type="text" id="major" name="major">
            </div>

            <div class="form-group">
                <label for="certificate">IT/클라우드 관련 공인 자격증:</label>
                <input type="text" id="certificate" name="certificate">
            </div>

            <div class="form-group">
                <label for="it_experience">IT관련 대회/공모전/대외활동 경험:</label>
                <textarea name="it_experience" id="it_experience" rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label>유사교육 수료 경험:</label>
                <select name="education_experience" id="education_experience" onchange="toggleOtherEducationInput();">
                    <option value="none">해당없음</option>
                    <option value="less-than-one-month">1개월 미만</option>
                    <option value="one-to-three-months">1개월 이상 ~ 3개월 미만</option>
                    <option value="three-to-six-months">3개월 이상</option>
                    <option value="other">기타</option>
                </select>
                <input type="text" id="other-education-input" name="other-education-name" placeholder="해당 교육명을 작성해주세요" style="display: none;">
            </div>

            <div class="form-group">
                <label>IT관련 업무 경험:</label>
                <select name="it_career_experience" id="it_career_experience" onchange="toggleCompanyInput();">
                    <option value="none">해당없음</option>
                    <option value="less-than-six-months">6개월 미만</option>
                    <option value="six-months-to-one-year">6개월 ~ 1년</option>
                    <option value="one-to-two-years">1년 ~ 2년</option>
                    <option value="two-to-three-years">2년 ~ 3년</option>
                    <option value="more-than-three-years">3년 이상</option>
                </select>
                <input type="text" id="company-name" name="company-name" placeholder="해당 기업명 및 업무" style="display: none;">
            </div>

            <div class="form-group">
                <label>내일배움카드 소지 여부:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="card_possession-has" name="card_possession" value="has" onclick="handleCheckbox(this)">
                    <label class="checkbox-label" for="learning-card-has">내일배움카드가 있습니다.</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="card_possession-will-issue" name="card_possession" value="will-issue" onclick="handleCheckbox(this)">
                    <label class="checkbox-label" for="learning-card-will-issue">내일배움카드를 발급 받을 예정입니다.</label>
                </div>
            </div>

            <div class="form-group">
                <label for="motivation_career_plan">지원동기 및 진로계획 (최소 50자 이상 작성):</label>
                <textarea name="motivation_career_plan" id="motivation_career_plan" rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label for="source_of_info">신청경로:</label>
                <select name="source_of_info" id="source_of_info" onchange="toggleOtherInput();">
                    <option value="naver-search">네이버 검색</option>
                    <option value="google-search">구글 검색</option>
                    <option value="naver-banner">네이버 배너 광고</option>
                    <option value="instagram">인스타그램</option>
                    <option value="youtube">유튜브</option>
                    <option value="blog-community">블로그/카페/커뮤니티</option>
                    <option value="kakao-open-chat">카카오톡 오픈채팅방</option>
                    <option value="email">메일</option>
                    <option value="bootcamp">부트텐트</option>
                    <option value="news-article">뉴스기사</option>
                    <option value="campus-center">대학 캠퍼스/취창업센터</option>
                    <option value="referral-employee">지인추천(교보DTS 임직원)</option>
                    <option value="referral-other">지인추천(기타)</option>
                    <option value="self-introduction-site">자소설닷컴</option>
                    <option value="other">기타</option>
                </select>
                <input type="text" id="other-input" name="application-source-other" placeholder="기타를 입력하세요" style="display: none;">
            </div>

            <button type="submit">제출</button>
        </form>
    </div>

    <script>
        function handleCheckbox(checkbox) {
            const checkboxes = document.querySelectorAll('input[name="card_possession"]');
            checkboxes.forEach((cb) => {
                if (cb !== checkbox) {
                    cb.checked = false;
                }
            });
        }

        function toggleOtherInput() {
            const applicationSource = document.getElementById('source_of_info');
            const otherInput = document.getElementById('other-input');
            otherInput.style.display = applicationSource.value === 'other' ? 'block' : 'none';
        }

        function toggleOtherEducationInput() {
            const similarEducation = document.getElementById('education_experience');
            const otherEducationInput = document.getElementById('other-education-input');
            otherEducationInput.style.display = similarEducation.value === 'other' ? 'block' : 'none';
        }

        function toggleCompanyInput() {
            const workExperience = document.getElementById('it_career_experience');
            const companyInput = document.getElementById('company-name');
            companyInput.style.display = workExperience.value !== 'none' ? 'block' : 'none';
        }
        document.getElementById('survey-form').addEventListener('submit', function(event) {
    event.preventDefault(); // 기본 제출 방지

    const formData = {
        applying_to: "교보 DTS Cloud Architecture DX Academy",
        name: document.getElementById('name').value,
        date_of_birth: document.getElementById('date_of_birth').value,
        phone_num: document.getElementById('phone_num').value,
        email: document.getElementById('email').value,
        residence: document.getElementById('residence').value,
        educational_background: document.getElementById('educational_background').value,
        school: document.getElementById('school').value,
        major: document.getElementById('major').value,
        certificate: document.getElementById('certificate').value,
        it_experience: document.getElementById('it_experience').value,
        education_experience: document.getElementById('education_experience').value,
        it_career_experience: document.getElementById('it_career_experience').value,
        card_possession: document.querySelector('input[name="card_possession"]:checked') ? 
                        document.querySelector('input[name="card_possession"]:checked').value : null,
        motivation_career_plan: document.getElementById('motivation_career_plan').value,
        source_of_info: document.getElementById('source_of_info').value,
    };

    fetch('/api/application/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'), // CSRF 토큰 추가
        },
        body: JSON.stringify(formData),
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Network response was not ok.');
    })
    .then(data => {
        console.log('Success:', data);
        // 추가 작업 (예: 성공 메시지 표시)
    })
    .catch((error) => {
        console.error('Error:', error);
        // 오류 처리
    });
});

    // CSRF 토큰을 가져오는 함수
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // CSRF 토큰을 찾습니다
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    };
</script>
</body>
</html>
